dep_gtk3 = dependency('gtk+-3.0', version: '>=3.24')
dep_x11 = dependency('x11')

gtk_dependencies = dependencies + [dep_gtk3, dep_x11]

desmume_src = [
  'avout_pipe_base.cpp',
  'avout_x264.cpp',
  'avout_flac.cpp',
  'config.cpp',
  'desmume.cpp',
  'dToolsList.cpp',
  'tools/ioregsView.cpp',
  '../shared/sndsdl.cpp',
  '../shared/ctrlssdl.cpp',
  'osmesa_3Demu.cpp',
  'glx_3Demu.cpp',
  'cheatsGTK.cpp',
  'main.cpp',
]

# TODO: why do we have to redeclare it here with one more fs level?
includes = [
  '../../../../src',
  '../../../../src/libretro-common/include',
  '../../../../src/frontend',
]

executable('desmume',
  desmume_src,
  dependencies: gtk_dependencies,
  include_directories: includes,
  link_with: libdesmume,
  cpp_args: ['-DGTK_DISABLE_DEPRECATED'],
  install: true,
)

install_data('desmume.desktop', install_dir: get_option('datadir') / 'applications')
install_data('DeSmuME.svg', install_dir: get_option('datadir') / 'pixmaps')
install_data('doc/desmume.1', install_dir: get_option('datadir') / 'man' / 'man1')
